﻿___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "tradedoubler_tag",
  "version": 1,
  "securityGroups": [],
  "displayName": "Tradedoubler",
  "categories": [
    "AFFILIATE_MARKETING",
    "ATTRIBUTION",
    "TAG_MANAGEMENT"
  ],
  "brand": {
    "id": "tradedoubler",
    "displayName": "Tradedoubler",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Setup our advanced conversion tracking quickly and seamlessly with the Tradedoubler tag.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "pt",
    "displayName": "Event",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SELECT",
        "name": "pageType",
        "displayName": "Type",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "landing",
            "displayValue": "Page loaded"
          },
          {
            "value": "Home",
            "displayValue": "Homepage"
          },
          {
            "value": "List_Products",
            "displayValue": "Products list"
          },
          {
            "value": "Product",
            "displayValue": "Product"
          },
          {
            "value": "Basket",
            "displayValue": "Basket"
          },
          {
            "value": "Registration",
            "displayValue": "Registration"
          },
          {
            "value": "lead",
            "displayValue": "Lead"
          },
          {
            "value": "sale",
            "displayValue": "Sale"
          }
        ],
        "simpleValueType": true,
        "notSetText": "",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "alwaysInSummary": true
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "ids",
    "displayName": "Tradedoubler ID-s",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "org",
        "displayName": "Organization ID",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          },
          {
            "type": "POSITIVE_NUMBER"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "prog",
        "displayName": "Program ID",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "POSITIVE_NUMBER"
          },
          {
            "type": "NON_EMPTY"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "landing",
        "type": "EQUALS"
      },
      {
        "paramName": "pageType",
        "paramValue": "lead",
        "type": "EQUALS"
      },
      {
        "paramName": "pageType",
        "paramValue": "sale",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "landing",
    "displayName": "Consents",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SELECT",
        "name": "cookieConsent",
        "displayName": "User cookie consent",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "notSetText": ""
      },
      {
        "type": "SELECT",
        "name": "trackingConsent",
        "displayName": "User tracking consent",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "notSetText": ""
      }
    ],
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "landing",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "details",
    "displayName": "Details",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "containerTagId",
        "displayName": "Container Tag ID",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "POSITIVE_NUMBER"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "pageType",
            "paramValue": "Home",
            "type": "EQUALS"
          },
          {
            "paramName": "pageType",
            "paramValue": "List_Products",
            "type": "EQUALS"
          },
          {
            "paramName": "pageType",
            "paramValue": "Product",
            "type": "EQUALS"
          },
          {
            "paramName": "pageType",
            "paramValue": "Basket",
            "type": "EQUALS"
          },
          {
            "paramName": "pageType",
            "paramValue": "Registration",
            "type": "EQUALS"
          },
          {
            "paramName": "pageType",
            "paramValue": "sale",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "eventId",
        "displayName": "Event ID",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "POSITIVE_NUMBER"
          },
          {
            "type": "NON_EMPTY"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "pageType",
            "paramValue": "lead",
            "type": "EQUALS"
          },
          {
            "paramName": "pageType",
            "paramValue": "sale",
            "type": "EQUALS"
          }
        ],
        "help": "Event ID determines type of sale or lead (e.g., a sign-up or Television sale) and ultimately the commission an affiliate will receive."
      },
      {
        "type": "SELECT",
        "name": "transactionId",
        "displayName": "Transaction ID",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "pageType",
            "paramValue": "lead",
            "type": "EQUALS"
          },
          {
            "paramName": "pageType",
            "paramValue": "sale",
            "type": "EQUALS"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "Your unique reference for the transaction taking place. This must be unique for each transaction and should ideally match your internal reference."
      },
      {
        "type": "SELECT",
        "name": "orderValue",
        "displayName": "Order value",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "help": "Value of the transaction (float). Please refer to your contract whether tax and/or shipping cost must be included.",
        "enablingConditions": [
          {
            "paramName": "pageType",
            "paramValue": "sale",
            "type": "EQUALS"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "currency",
        "displayName": "Currency",
        "simpleValueType": true,
        "defaultValue": "EUR",
        "enablingConditions": [
          {
            "paramName": "pageType",
            "paramValue": "sale",
            "type": "EQUALS"
          }
        ],
        "help": "This is the currency the order value is reported in, e.g. EUR, GBP, USD. The value must be a recognized currency code as per ISO-4217 (string, 3 chars)."
      },
      {
        "type": "SELECT",
        "name": "voucher",
        "displayName": "Voucher code",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "help": "This is the voucher code used by a customer. It allows Tradedoubler to enforce exclusive affiliate codes.",
        "enablingConditions": [
          {
            "paramName": "pageType",
            "paramValue": "sale",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "categoryName",
        "displayName": "Product category name",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "pageType",
            "paramValue": "List_Products",
            "type": "EQUALS"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "productSingle",
        "displayName": "Product details",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "pageType",
            "paramValue": "Product",
            "type": "EQUALS"
          }
        ],
        "help": "Details of product currently displayed (object). Example: {productId:\"abc\", productName:\"Product 1\", price:\"8.99\", category: \"Category name\"}",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "productsList",
        "displayName": "Products list",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "pageType",
            "paramValue": "List_Products",
            "type": "EQUALS"
          },
          {
            "paramName": "pageType",
            "paramValue": "Basket",
            "type": "EQUALS"
          },
          {
            "paramName": "pageType",
            "paramValue": "sale",
            "type": "EQUALS"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "List of products displayed on the page or in the basket (array).\nExample: [{id:\"abc\", price:\"8.99\", name:\"Product 1\", grpId:\"Tradedoubler group ID\", qty:\"1\"}]"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "Home",
        "type": "EQUALS"
      },
      {
        "paramName": "pageType",
        "paramValue": "List_Products",
        "type": "EQUALS"
      },
      {
        "paramName": "pageType",
        "paramValue": "Product",
        "type": "EQUALS"
      },
      {
        "paramName": "pageType",
        "paramValue": "Basket",
        "type": "EQUALS"
      },
      {
        "paramName": "pageType",
        "paramValue": "Registration",
        "type": "EQUALS"
      },
      {
        "paramName": "pageType",
        "paramValue": "lead",
        "type": "EQUALS"
      },
      {
        "paramName": "pageType",
        "paramValue": "sale",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "cdt",
    "displayName": "Cross device tracking",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SELECT",
        "name": "extType",
        "displayName": "User ID type",
        "selectItems": [
          {
            "value": 1,
            "displayValue": "SHA-256 encrypted User email"
          },
          {
            "value": 0,
            "displayValue": "Internal user ID"
          },
          {
            "value": 100,
            "displayValue": "User email address"
          }
        ],
        "simpleValueType": true,
        "help": "Defines the user ID type. An internal user ID is only to be used if you do not have access to the user\u0027s email address.",
        "notSetText": ""
      },
      {
        "type": "SELECT",
        "name": "extIdUserEmailSHA256",
        "displayName": "SHA-256 encrypted User email",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "notSetText": "",
        "help": "The user\u0027s email address (i.e. the email address of the user currently logged into your site, not your own email address). The value must be hashed using SHA-256 before being included.",
        "enablingConditions": [
          {
            "paramName": "extType",
            "paramValue": 1,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "extIdUserId",
        "displayName": "Internal user ID",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "notSetText": "",
        "help": "The user\u0027s ID",
        "enablingConditions": [
          {
            "paramName": "extType",
            "paramValue": 0,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "LABEL",
        "name": "extIdUserEmailLabel",
        "displayName": "Users\u0027 privacy is paramount. Any email address you provide will be encrypted using the SHA-256 algorithm before being sent to Tradedoubler.",
        "enablingConditions": [
          {
            "paramName": "extType",
            "paramValue": 100,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "extIdUserEmail",
        "displayName": "User email address",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "notSetText": "",
        "help": "The user\u0027s email address (i.e. the email address of the user currently logged into your site, not your own email address).",
        "enablingConditions": [
          {
            "paramName": "extType",
            "paramValue": 100,
            "type": "EQUALS"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "lead",
        "type": "EQUALS"
      },
      {
        "paramName": "pageType",
        "paramValue": "sale",
        "type": "EQUALS"
      }
    ],
    "help": "Allows you to track user activity across devices."
  },
  {
    "type": "GROUP",
    "name": "vo",
    "displayName": "Valid On",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "SELECT",
        "name": "validOn",
        "displayName": "Valid On date",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "notSetText": "",
        "help": "A date when the transaction should become approved in Tradedoubler platform. Format: YYYY-MM-DD"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "lead",
        "type": "EQUALS"
      },
      {
        "paramName": "pageType",
        "paramValue": "sale",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "extras",
    "displayName": "Conversion\u0027s advanced options",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "RADIO",
        "name": "element",
        "displayName": "HTML element",
        "radioItems": [
          {
            "value": "iframe",
            "displayValue": "iframe"
          },
          {
            "value": "img",
            "displayValue": "img"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "iframe"
      },
      {
        "type": "TEXT",
        "name": "ttid",
        "displayName": "ttid",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NUMBER"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "trafficSource",
        "displayName": "Traffic source name",
        "simpleValueType": true
      }
    ],
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "lead",
        "type": "EQUALS"
      },
      {
        "paramName": "pageType",
        "paramValue": "sale",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const queryPermission = require('queryPermission');
const injectScript = require('injectScript');
const setInWindow = require('setInWindow');
const callInWindow = require('callInWindow');
const sha256 = require('sha256');

const td = 'Tradedoubler GTM tag | ';
const version = 'gtmtag_1.0.1';

log(td + ' data =', data);

// Prerequisities
if (queryPermission('access_globals', 'readwrite', 'TDConf') === false || queryPermission('access_globals', 'execute', 'tdconv') === false || queryPermission('access_globals', 'execute', 'tdcontainer') === false) {
  log(td + 'Error: Access to globals not granted.');
  data.gtmOnFailure();
}

// TDConf
let b = {Config: {}};
if (data.productSingle) {b.Config = data.productSingle;}
if (data.transactionId) {b.Config.orderId = data.transactionId;}
if (data.orderValue) {b.Config.orderValue = data.orderValue;}
if (data.currency) {b.Config.currency = data.currency;}
if (data.categoryName) {b.Config.Category_name = data.categoryName;}
if (data.productsList) {b.Config.products = data.productsList;}
if (data.pageType !== 'landing') {
  log(td + 'TDConf =', b);
  setInWindow('TDConf', b, true);
}

// TDConversion
let c = {};
if (data.transactionId) {c.transactionId = data.transactionId;}
if (data.orderValue) {c.ordervalue = data.orderValue;}
if (data.currency) {c.currency = data.currency;}
if (data.eventId) {c.event = data.eventId;}
if (data.voucher) {c.voucher = data.voucher;}
if (data.validOn) {c.validOn = data.validOn;}
if (data.productsList) {c.products = data.productsList;}
if (data.voucher) {c.voucher = data.voucher;}
if (data.ttid) {c.ttid = data.ttid;}
if (data.trafficSource) {c.trafficSource = data.trafficSource;}

if (data.extType === 1) {
  c.cdt = {extType: 1, extId: data.extIdUserEmailSHA256};
} else if (data.extType === 0) {
  c.cdt = {extType: 0, extId: data.extIdUserId};
} else if (data.extType === 100) {
  c.cdt = {extType: 1};
  sha256(data.extIdUserEmail, (digest) => {
    c.cdt.extId = digest;
    log(td + 'Calculating sha256 hash... cdt.extId =', digest);
  }, null, {outputEncoding: 'hex'});
}

if (data.pageType === 'lead' || data.pageType === 'sale') {
  log(td + 'TDConversion =', c);
}

// Events
const init = () => {
  log(td + 'Processing event "' + data.pageType + '"...');

  switch(data.pageType) {
    // landing
    case 'landing':
      if (typeof data.cookieConsent === 'boolean') {
        callInWindow('tdconv', 'cookie-consent', data.cookieConsent);
      }
      if (typeof data.trackingConsent === 'boolean') {
        callInWindow('tdconv', 'tracking-consent', data.trackingConsent);
      }
      callInWindow('tdconv', 'landing');
      callInWindow('tdconv', 'container');
      break;

    // lead
    case 'lead':
      callInWindow('tdconv', 'init', data.org, {element: data.element, program: true, programId: data.prog});
      callInWindow('tdconv', 'track', 'lead', c);
      break;
      
    // sale
    case 'sale':
      callInWindow('tdconv', 'init', data.org, {element: data.element, program: true, programId: data.prog});
      callInWindow('tdconv', 'track', 'sale', c);
  }
};

if (data.org && data.prog) {
  let url = "https://svht.tradedoubler.com/tr_sdk.js?org=" + data.org + "&prog=" + data.prog + '&v=' + version;
  log(td + 'Tracking Library =', url);
  injectScript(url, init, data.gtmOnFailure, 'sdk');
}

// Container
const ctLoad = () => {
  log(td + 'Container Tag loading success.');
  if (!callInWindow('tdcontainer', pageType)) {
    log(td + 'Error calling function tdcontainer("' + pageType + '").');
  }
};

let pageType = data.pageType;
if (data.pageType === 'sale') {
  pageType = 'Purchase';
}
if (data.containerTagId && (pageType === 'Home' || pageType === 'List_Products' || pageType === 'Product' || pageType === 'Basket' || pageType === 'Registration' || pageType === 'Purchase')) {
  log(td + 'Processing container tag case "' + pageType + '"...');
  let ct = "https://swrap.tradedoubler.com/wrap?id=" + data.containerTagId + '&v=' + version;
  injectScript(ct, ctLoad, data.gtmOnFailure, 'ct');
}

data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "TDConf"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "tdconv"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "tdcontainer"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.tradedoubler.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 25/7/2024, 1:02:03 PM


